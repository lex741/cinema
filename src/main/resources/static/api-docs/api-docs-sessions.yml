openapi: 3.0.3
info:
  title: Cinema API - Sessions
  version: 1.0.0
  description: >
    REST API для керування сеансами кінотеатру.
    Містить CRUD, фільтрацію/пагінацію та часткове оновлення (RFC 7386 JSON Merge Patch).
servers:
  - url: http://localhost:8080
tags:
  - name: Sessions
    description: Операції з сеансами

paths:
  /api/sessions:
    get:
      tags: [Sessions]
      summary: Список сеансів (фільтрація + пагінація)
      description: >
        Повертає сторінку сеансів. Доступні фільтри за назвою (title), залом (hall),
        діапазоном часу (from/to) та пагінація (page/size).
      operationId: listSessions
      parameters:
        - name: title
          in: query
          required: false
          description: Пошук за частиною назви фільму (case-insensitive).
          schema:
            type: string
          example: dune
        - name: hall
          in: query
          required: false
          description: Фільтр за назвою залу.
          schema:
            type: string
          example: Hall A
        - name: from
          in: query
          required: false
          description: Початок діапазону часу (ISO 8601).
          schema:
            type: string
            format: date-time
          example: "2026-01-01T00:00:00"
        - name: to
          in: query
          required: false
          description: Кінець діапазону часу (ISO 8601).
          schema:
            type: string
            format: date-time
          example: "2026-01-31T23:59:59"
        - name: page
          in: query
          required: false
          description: Номер сторінки (починається з 0).
          schema:
            type: integer
            minimum: 0
            default: 0
          example: 0
        - name: size
          in: query
          required: false
          description: Розмір сторінки (1..100).
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
          example: 10
      responses:
        "200":
          description: OK — сторінка сеансів
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PagedSessionResponse"
        "400":
          description: Bad Request — некоректні параметри пагінації/фільтра
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

    post:
      tags: [Sessions]
      summary: Створити сеанс
      description: >
        Створює новий сеанс і генерує схему місць (rows, seatsPerRow).
        Повертає створений сеанс з id і seats.
      operationId: createSession
      requestBody:
        required: true
        description: Дані для створення сеансу
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MovieSessionCreateRequest"
            examples:
              example1:
                value:
                  movieTitle: "Interstellar"
                  hall: "Hall A"
                  startTime: "2026-01-10T18:30:00"
                  price: 180
                  rows: 6
                  seatsPerRow: 10
      responses:
        "201":
          description: Created — сеанс створено
          headers:
            Location:
              description: URL створеного ресурсу
              schema:
                type: string
              example: "/api/sessions/1"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MovieSession"
        "400":
          description: Bad Request — некоректні дані (наприклад rows <= 0)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /api/sessions/{id}:
    get:
      tags: [Sessions]
      summary: Отримати сеанс за id
      description: Повертає сеанс. Якщо id не знайдено — 404.
      operationId: getSession
      parameters:
        - name: id
          in: path
          required: true
          description: ID сеансу
          schema:
            type: integer
            format: int64
          example: 1
      responses:
        "200":
          description: OK — дані сеансу
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MovieSession"
        "404":
          description: Not Found — сеанс не знайдено
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

    put:
      tags: [Sessions]
      summary: Повне оновлення сеансу (PUT)
      description: >
        Повністю оновлює поля movieTitle/hall/startTime/price.
        Схема місць seats не перегенеровується (щоб не скидати броні).
      operationId: updateSession
      parameters:
        - name: id
          in: path
          required: true
          description: ID сеансу
          schema:
            type: integer
            format: int64
          example: 1
      requestBody:
        required: true
        description: Дані для повного оновлення
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MovieSessionUpdateRequest"
            examples:
              example1:
                value:
                  movieTitle: "Interstellar (Extended)"
                  hall: "Hall A"
                  startTime: "2026-01-10T19:00:00"
                  price: 200
      responses:
        "200":
          description: OK — оновлений сеанс
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MovieSession"
        "400":
          description: Bad Request — некоректні дані
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "404":
          description: Not Found — сеанс не знайдено
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

    patch:
      tags: [Sessions]
      summary: Часткове оновлення сеансу (PATCH, RFC 7386)
      description: >
        Частково оновлює сеанс через JSON Merge Patch (RFC 7386).
        Обов'язковий Content-Type: application/merge-patch+json.
        Приклад: { "price": 210 }.
      operationId: patchSession
      parameters:
        - name: id
          in: path
          required: true
          description: ID сеансу
          schema:
            type: integer
            format: int64
          example: 1
      requestBody:
        required: true
        description: JSON Merge Patch документ (будь-яка підмножина полів)
        content:
          application/merge-patch+json:
            schema:
              $ref: "#/components/schemas/MovieSessionMergePatch"
            examples:
              patchPrice:
                value:
                  price: 210
              patchTitle:
                value:
                  movieTitle: "Dune Part Two"
      responses:
        "200":
          description: OK — оновлений сеанс
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MovieSession"
        "400":
          description: Bad Request — некоректний patch або тип даних
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "404":
          description: Not Found — сеанс не знайдено
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

    delete:
      tags: [Sessions]
      summary: Видалити сеанс
      description: Видаляє сеанс за id. Повертає 204, навіть без тіла відповіді.
      operationId: deleteSession
      parameters:
        - name: id
          in: path
          required: true
          description: ID сеансу
          schema:
            type: integer
            format: int64
          example: 1
      responses:
        "204":
          description: No Content — сеанс видалено
        "404":
          description: Not Found — сеанс не знайдено
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

components:
  schemas:
    ApiError:
      type: object
      description: Структура помилки API
      properties:
        timestamp:
          type: string
          format: date-time
          description: Час виникнення помилки
        status:
          type: integer
          description: HTTP статус код
          example: 404
        error:
          type: string
          description: Текстовий опис статусу
          example: Not Found
        message:
          type: string
          description: Повідомлення помилки
          example: 999
        path:
          type: string
          description: Шлях запиту
          example: /api/sessions/999

    Seat:
      type: object
      description: Місце в залі
      properties:
        id:
          type: string
          description: Унікальний ідентифікатор місця (ряд/місце)
          example: R1-S1
        row:
          type: integer
          description: Номер ряду
          example: 1
        number:
          type: integer
          description: Номер місця в ряду
          example: 1
        reserved:
          type: boolean
          description: Чи зайняте місце
          example: false

    MovieSession:
      type: object
      description: Сеанс кінотеатру
      properties:
        id:
          type: integer
          format: int64
          description: ID сеансу
          example: 1
        movieTitle:
          type: string
          description: Назва фільму
          example: Interstellar
        hall:
          type: string
          description: Назва залу
          example: Hall A
        startTime:
          type: string
          format: date-time
          description: Час початку
          example: "2026-01-10T18:30:00"
        price:
          type: number
          format: double
          description: Ціна квитка за 1 місце
          example: 180
        seats:
          type: array
          description: Список місць (генерується під час створення)
          items:
            $ref: "#/components/schemas/Seat"

    MovieSessionCreateRequest:
      type: object
      description: Запит на створення сеансу + генерація місць
      required: [movieTitle, hall, startTime, price, rows, seatsPerRow]
      properties:
        movieTitle:
          type: string
          description: Назва фільму
          example: Interstellar
        hall:
          type: string
          description: Назва залу
          example: Hall A
        startTime:
          type: string
          format: date-time
          description: Час початку (ISO 8601)
          example: "2026-01-10T18:30:00"
        price:
          type: number
          format: double
          description: Ціна квитка
          example: 180
        rows:
          type: integer
          description: Кількість рядів
          example: 6
          minimum: 1
        seatsPerRow:
          type: integer
          description: Місць у кожному ряду
          example: 10
          minimum: 1

    MovieSessionUpdateRequest:
      type: object
      description: Запит на повне оновлення сеансу (без перегенерації місць)
      required: [movieTitle, hall, startTime, price]
      properties:
        movieTitle:
          type: string
          description: Назва фільму
          example: Interstellar (Extended)
        hall:
          type: string
          description: Назва залу
          example: Hall A
        startTime:
          type: string
          format: date-time
          description: Час початку (ISO 8601)
          example: "2026-01-10T19:00:00"
        price:
          type: number
          format: double
          description: Ціна квитка
          example: 200

    MovieSessionMergePatch:
      type: object
      description: >
        JSON Merge Patch (RFC 7386). Можна передати будь-яку підмножину полів.
      properties:
        movieTitle:
          type: string
          description: Нова назва фільму
        hall:
          type: string
          description: Новий зал
        startTime:
          type: string
          format: date-time
          description: Новий час початку
        price:
          type: number
          format: double
          description: Нова ціна

    PagedSessionResponse:
      type: object
      description: Сторінка з сеансами
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/MovieSession"
        page:
          type: integer
          example: 0
        size:
          type: integer
          example: 10
        totalElements:
          type: integer
          example: 25
        totalPages:
          type: integer
          example: 3
